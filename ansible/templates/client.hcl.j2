# Nomad Client Configuration
client {
  enabled = true
  servers = ["127.0.0.1"]

  host_volume_plugin "mkdir" {}
}

plugin_dir = "{{ nomad_plugin_dir }}"

# Dynamic host volumes - directories created automatically by mkdir plugin
{% if media_server == "plex" or media_server == "both" %}
host_volume "plex-config" {
  type      = "host"
  plugin_id = "mkdir"

  capability {
    access_mode     = "single-node-writer"
    attachment_mode = "file-system"
  }

  parameters {
    path = "{{ plex_config_dir }}"
    mode = "0755"
    uid  = "{{ user_uid }}"
    gid  = "{{ group_gid }}"
  }
}

host_volume "plex-transcode" {
  type      = "host"
  plugin_id = "mkdir"

  capability {
    access_mode     = "single-node-writer"
    attachment_mode = "file-system"
  }

  parameters {
    path = "{{ plex_transcode_dir }}"
    mode = "0755"
    uid  = "{{ user_uid }}"
    gid  = "{{ group_gid }}"
  }
}
{% endif %}

{% if media_server == "jellyfin" or media_server == "both" %}
host_volume "jellyfin-config" {
  type      = "host"
  plugin_id = "mkdir"

  capability {
    access_mode     = "single-node-writer"
    attachment_mode = "file-system"
  }

  parameters {
    path = "{{ jellyfin_config_dir }}"
    mode = "0755"
  }
}

host_volume "jellyfin-cache" {
  type      = "host"
  plugin_id = "mkdir"

  capability {
    access_mode     = "single-node-writer"
    attachment_mode = "file-system"
  }

  parameters {
    path = "{{ jellyfin_cache_dir }}"
    mode = "0755"
  }
}
{% endif %}
